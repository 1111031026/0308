# 附近討論功能使用說明

## 📋 功能概述

「附近討論」是一個基於 GPS 定位的環保討論功能，讓用戶可以：
1. 根據位置查看附近的環保討論
2. 分享實地環保活動的地點
3. 與附近用戶互動，促進在地環保社群

## 🗄️ 資料庫設定

### 步驟 1：執行 SQL 語句

請在 phpMyAdmin 或 MySQL 中執行 `nearby_post_table.sql` 檔案，建立 `nearby_post` 資料表。

### 步驟 2：確認資料表結構

執行後，確認資料表包含以下欄位：
- `PostID` - 貼文編號（主鍵）
- `Title` - 標題
- `Content` - 內容
- `UserID` - 使用者編號（外鍵）
- `Latitude` - 緯度
- `Longitude` - 經度
- `LocationName` - 地點名稱
- `ImageURL` - 圖片網址
- `PostDate` - 發文日期

## 🗺️ Google Maps API 設定

### 步驟 1：取得 API Key

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 建立新專案或選擇現有專案
3. 啟用「Maps JavaScript API」和「Places API」
4. 建立 API Key

### 步驟 2：設定 API Key

在以下檔案中，將 `YOUR_API_KEY` 替換為您的 Google Maps API Key：

1. `php/nearby_post.php` (第 20 行)
2. `php/nearby_discussion.php` (第 18 行)
3. `php/nearby_discuss.php` (第 20 行)

例如：
```html
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_ACTUAL_API_KEY&libraries=places"></script>
```

### 步驟 3：設定 API 限制（建議）

在 Google Cloud Console 中設定 API Key 的限制：
- HTTP 參照網址限制：加入您的網域
- API 限制：僅允許 Maps JavaScript API 和 Places API

## 📁 檔案結構

新增的檔案：

```
php/
  ├── nearby_post.php          # 發文頁面
  ├── nearby_discussion.php    # 附近討論主頁面
  ├── nearby_discuss.php        # 貼文詳情頁面
  └── get_nearby_posts.php      # API 端點（取得附近貼文）

css/
  ├── nearby_discussion.css     # 附近討論頁面樣式
  ├── nearby_post.css           # 發文頁面樣式
  └── nearby_discuss.css        # 貼文詳情頁面樣式

js/
  └── nearby_discussion.js      # 附近討論功能 JavaScript

nearby_post_table.sql           # 資料表建立 SQL
```

## 🔗 導航選單整合（選填）

如果您想在導航選單中加入「附近討論」連結，可以在 `php/nav.php` 中加入：

```php
<li><a href="nearby_discussion.php" style="font-size: 16px;">附近討論</a></li>
```

## 🚀 使用流程

### 用戶發文流程：

1. 進入 `nearby_post.php`
2. 填寫標題和內容
3. 選擇「分享位置」（選填）
4. 點擊「取得目前位置」或在地圖上點擊選擇位置
5. 可選填地點名稱
6. 提交貼文

### 查看附近討論流程：

1. 進入 `nearby_discussion.php`
2. 允許瀏覽器取得位置權限
3. 系統自動顯示附近的討論
4. 可調整搜尋範圍（1-20 公里）
5. 點擊貼文查看詳情

## ⚠️ 注意事項

1. **位置權限**：此功能需要用戶允許瀏覽器取得位置資訊
2. **HTTPS**：在生產環境中，Geolocation API 需要 HTTPS
3. **API 配額**：注意 Google Maps API 的使用配額，避免超額
4. **隱私保護**：位置資訊僅用於顯示附近討論，不會公開精確座標

## 🐛 常見問題

### Q: 地圖無法顯示？
A: 請確認：
- Google Maps API Key 是否正確設定
- API Key 是否已啟用 Maps JavaScript API
- 瀏覽器控制台是否有錯誤訊息

### Q: 無法取得位置？
A: 請確認：
- 瀏覽器是否允許位置權限
- 是否使用 HTTPS（生產環境）
- 裝置是否支援 GPS

### Q: 附近沒有顯示貼文？
A: 請確認：
- 資料庫中是否有帶有 GPS 座標的貼文
- 搜尋範圍是否合適
- 位置權限是否已允許

## 📝 未來擴充建議

1. 創建獨立的 `nearby_comment` 表，避免與 `commentarea` 的 PostID 衝突
2. 加入「鄰近用戶」功能，顯示附近的用戶
3. 加入「活動類型」分類（淨灘、植樹、環保講座等）
4. 加入「活動時間」欄位，支援活動預告

## 📞 技術支援

如有問題，請檢查：
1. 瀏覽器控制台的錯誤訊息
2. PHP 錯誤日誌
3. 資料庫連線是否正常
4. API Key 是否有效

